env:
  contexts:
    - name: "juice-shop-context"
      urls:
        - "https://juice-shop.herokuapp.com"
      includePaths:
        - "https://juice-shop.herokuapp.com/.*"

      authentication:
        method: "json"
        parameters:
          loginUrl: "https://juice-shop.herokuapp.com/rest/user/login"
          loginRequestData: |
            {
              "email": "{%username%}",
              "password": "{%password%}"
            }
        verification:
          method: "poll"
          loggedInRegex: "Logout"
          loggedOutRegex: "Login"

      sessionManagement:
        method: "cookieBased"

      users:
        - name: "admin-user"
          credentials:
            username: "admin@juice-sh.op"
            password: "admin123"

jobs:
  # 1️⃣ Spider the application as the authenticated user
  - type: spider
    parameters:
      context: "juice-shop-context"
      user: "admin-user"
      maxDuration: 5

  # 2️⃣ Active scan (authenticated)
  - type: activeScan
    parameters:
      context: "juice-shop-context"
      user: "admin-user"
      maxDuration: 5

  # 3️⃣ Generate reports
  - type: report
    parameters:
      template: traditional-html
      reportDir: .
      reportFile: report_html.html

  - type: report
    parameters:
      template: traditional-json
      reportDir: .
      reportFile: report_json.json

  - type: report
    parameters:
      template: traditional-md
      reportDir: .
      reportFile: report_md.md
