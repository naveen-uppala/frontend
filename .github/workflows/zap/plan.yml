env:
  contexts:
    - name: juice-shop-context
      urls:
        - https://juice-shop.herokuapp.com
      includePaths:
        - https://juice-shop.herokuapp.com/.*

      # ğŸ” SCRIPT-BASED AUTHENTICATION (FAILS HARD IF LOGIN FAILS)
      authentication:
        method: script
        parameters:
          scriptName: juice-shop-auth
          scriptType: authentication
          scriptEngine: ECMAScript
          scriptFile: .github/workflows/zap/scripts/juice-shop-auth.js

      # ğŸª Session handled via cookies
      sessionManagement:
        method: cookie

      # ğŸ‘¤ Authenticated user
      users:
        - name: admin-user
          credentials:
            username: admin@juice-sh.op
            password: admin123

jobs:
  # ğŸ•· Authenticated spider
  - type: spider
    parameters:
      context: juice-shop-context
      user: admin-user
      maxDuration: 5

  # ğŸ”¥ Authenticated active scan
  - type: activeScan
    parameters:
      context: juice-shop-context
      user: admin-user
      maxScanDurationInMins: 5

  # ğŸ“„ Reports
  - type: report
    parameters:
      template: traditional-html
      reportDir: .
      reportFile: report_html.html

  - type: report
    parameters:
      template: traditional-json
      reportDir: .
      reportFile: report_json.json

  - type: report
    parameters:
      template: traditional-md
      reportDir: .
      reportFile: report_md.md
